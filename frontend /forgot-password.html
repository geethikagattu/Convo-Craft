<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forgot Password â€“ ConvoCraft</title>
<link rel="stylesheet" href="style2.css">
</head>
<body>

<div class="auth-container">
  <div class="auth-card">
    <h2>Forgot Password? ðŸ”‘</h2>

    <!-- Step 1: Enter Email -->
    <form id="email-form" style="display: block;">
      <input type="email" id="email" placeholder="Enter your email" required>
      <button type="submit">Send Reset Code</button>
    </form>

    <!-- Step 2: Enter Code & New Password -->
    <form id="reset-form" style="display: none;">
      <input type="text" id="reset-code" placeholder="Enter 6-digit code" maxlength="6" required>
      <input type="password" id="new-password" placeholder="New Password" required>
      <button type="submit">Reset Password</button>
    </form>

    <p><a href="login.html">Back to Login</a></p>
  </div>
</div>

<script>
let userEmail = '';

// Step 1: Request reset code
document.getElementById("email-form").addEventListener("submit", async function(e){
  e.preventDefault();
  
  const email = document.getElementById("email").value;
  userEmail = email;

  try {
    const response = await fetch('http://localhost:5001/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });

    const data = await response.json();

    if (response.ok) {
      alert(`Reset code sent! Code: ${data.resetCode}\n(Check server console in production)`);
      
      // Show reset form
      document.getElementById("email-form").style.display = "none";
      document.getElementById("reset-form").style.display = "block";
    } else {
      alert('Error: ' + data.error);
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Network error!');
  }
});

// Step 2: Reset password
document.getElementById("reset-form").addEventListener("submit", async function(e){
  e.preventDefault();
  
  const resetCode = document.getElementById("reset-code").value;
  const newPassword = document.getElementById("new-password").value;

  try {
    const response = await fetch('http://localhost:5001/reset-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        email: userEmail, 
        resetCode, 
        newPassword 
      })
    });

    const data = await response.json();

    if (response.ok) {
      alert('Password reset successful! âœ…');
      window.location.href = 'login.html';
    } else {
      alert('Error: ' + data.error);
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Network error!');
  }
});
</script>

</body>
</html>